"use strict";(self.webpackChunkstreams_docs=self.webpackChunkstreams_docs||[]).push([[4902],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=a.createContext({}),p=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(d.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,g=u["".concat(d,".").concat(m)]||u[m]||c[m]||i;return n?a.createElement(g,o(o({ref:t},s),{},{components:n})):a.createElement(g,o({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3771:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:6},o="FairPlay Configuration",l={unversionedId:"drm-service/fairplay-configuration",id:"drm-service/fairplay-configuration",title:"FairPlay Configuration",description:"Through FairPlay Configuration, you can specify the desired FairPlay license specification within the license request.",source:"@site/docs/drm-service/fairplay-configuration.md",sourceDirName:"drm-service",slug:"/drm-service/fairplay-configuration",permalink:"/docs/drm-service/fairplay-configuration",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"drmSidebar",previous:{title:"Widevine Configuration",permalink:"/docs/drm-service/widevine-configuration"},next:{title:"Widevine Specs",permalink:"/docs/drm-service/widevine-specs"}},d={},p=[{value:"Generate Encoded Data",id:"generate-encoded-data",level:3},{value:"Generating Content Data",id:"generating-content-data",level:3},{value:"Generating Signature",id:"generating-signature",level:3}],s={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"fairplay-configuration"},"FairPlay Configuration"),(0,r.kt)("p",null,"Through FairPlay Configuration, you can specify the desired FairPlay license specification within the license request."),(0,r.kt)("p",null,"This API requires ",(0,r.kt)("a",{parentName:"p",href:"#generate-encoded-data"},"encoded_data")," in the query param for authentication."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"POST: https://app.tpstreams.com/api/v1/<org_code>/drm_license/?data=<encoded_data>/\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Fields")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"spc"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Server Playback Context (SPC) \u2014 the key message from the player, typically base64-encoded."),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"fairplay"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"See the FairPlay table below for available fields."),(0,r.kt)("td",{parentName:"tr",align:null},"No")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"FairPlay")),(0,r.kt)("table",null,(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},(0,r.kt)("strong",{parentName:"p"},"Name"))),(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},(0,r.kt)("strong",{parentName:"p"},"Description")))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},"lease_duration_seconds (optional)")),(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},"How long a streaming (online) license is valid (secon"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},"rental_duration_seconds (optional)")),(0,r.kt)("td",{parentName:"tr",colSpan:1,rowSpan:1},(0,r.kt)("p",{parentName:"td"},"How long offline licenses remain valid (seconds). Def"))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample Payload:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "spc": "base64EncodedSPCFromPlayer",\n    "fairplay": {\n        "lease_duration_seconds": 1800,\n        "rental_duration_seconds": 86400\n    }\n}\n')),(0,r.kt)("p",null,"You can obtain the encoded data by performing the following steps in Python:"),(0,r.kt)("h3",{id:"generate-encoded-data"},"Generate Encoded Data"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import base64\nimport binascii\nimport hashlib\nimport json\n\nfrom Cryptodome.Cipher import AES\nfrom Cryptodome.Util.Padding import pad\n\nencoded_content_data = generate_content_data(<content_id>)\nsignature = generate_signature(encoded_content_data)\ndata = {\"content_data\": encoded_content_data, \"signature\": signature}\ndata = json.dumps(data, separators=(',', ':'))\nencoded_data = base64.urlsafe_b64encode(data).decode()\n")),(0,r.kt)("p",null,"To generate encoded data you need content data ",(0,r.kt)("a",{parentName:"p",href:"#generating-content-data"},"Generating Content Data")," and ",(0,r.kt)("a",{parentName:"p",href:"#generating-signature"},"Generate Signature"),"."),(0,r.kt)("h3",{id:"generating-content-data"},"Generating Content Data"),(0,r.kt)("p",null,"You can obtain the content data by performing the following steps in Python:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport base64\n\ndef generate_content_data(content_id, download=False, drm_type="fairplay"):\n  data = {\n    "content_id": content_id,\n    "download": download,\n    "drm_type": drm_type,\n  }\n  data_str = json.dumps(data, separators=(\',\', \':\'))\n  return base64.urlsafe_b64encode(data_str.encode()).decode()\n')),(0,r.kt)("h3",{id:"generating-signature"},"Generating Signature"),(0,r.kt)("p",null,"You can obtain the signature field by performing the following steps in Python:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import base64\nimport binascii\nimport hashlib\nimport json\n\nfrom Cryptodome.Cipher import AES\nfrom Cryptodome.Util.Padding import pad\n\ndef generate_signature(data, key, iv):\n    hash = hashlib.sha1(data.encode()).digest()\n    cipher = AES.new(\n        binascii.unhexlify(key),\n        AES.MODE_CBC,\n        binascii.unhexlify(iv),\n    )\n    padded_hash = pad(hash, AES.block_size, style="pkcs7")\n    signature = cipher.encrypt(padded_hash)\n    return base64.b64encode(signature).decode()\n\nkey = "xxxx"  # AES Signing key\niv = "yyy"    # AES Signing iv\nencoded_content_data = generate_content_data("cf6c30dd50c1492e82344ea3e139da1d")\nsignature = generate_signature(encoded_content_data, key, iv)\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Parameters")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"org_code"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The organization code for API endpoint"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"content_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The unique identifier for the content (UUID used when encrypting the video)."),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AES_SIGNING_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The AES key used for signing the content data"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AES_SIGNING_IV"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The initialization vector (IV) for signing"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,r.kt)("admonition",{type:"important"},(0,r.kt)("p",{parentName:"admonition"},"AES_SIGNING_KEY, AES_SIGNING_IV and org_code will be provided by us."),(0,r.kt)("p",{parentName:"admonition"},"You can retrieve the organization code and DRM keys by making a GET request to the API. ",(0,r.kt)("a",{parentName:"p",href:"/docs/server-api/organizations"},"Organization"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Security Considerations:")),(0,r.kt)("p",null,"The recommendation is to invoke the DRM license endpoint on the server, rather than on the client. This precaution is taken because passing the license configuration and calling it from the client could expose configurations to users."))}c.isMDXComponent=!0}}]);