"use strict";(self.webpackChunkstreams_docs=self.webpackChunkstreams_docs||[]).push([[7404],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=l(n),g=a,y=u["".concat(s,".").concat(g)]||u[g]||d[g]||i;return n?r.createElement(y,o(o({ref:t},c),{},{components:n})):r.createElement(y,o({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,o[1]=p;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4256:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:2},o="Encrypting the content",p={unversionedId:"drm-service/encrypting",id:"drm-service/encrypting",title:"Encrypting the content",description:"The encryption process varies depending on the technology used. For Widevine and FairPlay, there are different entry paths and parameters involved in encrypting content. Each DRM provider has its own distinct approach to ensure secure protection for media content.",source:"@site/docs/drm-service/encrypting.md",sourceDirName:"drm-service",slug:"/drm-service/encrypting",permalink:"/docs/drm-service/encrypting",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"drmSidebar",previous:{title:"DRM Service",permalink:"/docs/drm-service/getting-started"},next:{title:"Getting license to playback the content",permalink:"/docs/drm-service/get-license"}},s={},l=[{value:"Widevine Encryption",id:"widevine-encryption",level:2},{value:"Fairplay Encryption",id:"fairplay-encryption",level:2},{value:"Generating Request Body:",id:"generating-request-body",level:3},{value:"Generating Signature:",id:"generating-signature",level:3}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"encrypting-the-content"},"Encrypting the content"),(0,a.kt)("p",null,"The encryption process varies depending on the technology used. For Widevine and FairPlay, there are different entry paths and parameters involved in encrypting content. Each DRM provider has its own distinct approach to ensure secure protection for media content."),(0,a.kt)("h2",{id:"widevine-encryption"},"Widevine Encryption"),(0,a.kt)("p",null,"Shaka Packager is used for encrypting content and offers seamless integration with Widevine, making it a popular choice for ensuring secure delivery through the Widevine DRM technology. ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/shaka-project/shaka-packager"},"Shaka Packager")),(0,a.kt)("p",null,"To encrypt your content, you can utilize Shaka Packager by running the following command with ",(0,a.kt)("a",{parentName:"p",href:"/docs/server-api/authentication"},"authentication Header"),".\n:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"\n  packager \\\n  in=https://static.testpress.in/BigBuckBunny.mp4,stream=audio,output=audio.mp4 \\\n  in=https://static.testpress.in/BigBuckBunny.mp4,stream=video,output=h264_360p.mp4 \\\n  --enable_widevine_encryption \\\n  --key_server_url https://app.tpstreams.com/api/v1/<org_code>/widevine_key/ \\\n  --content_id <content_id> \\\n  --signer testpress \\\n  --aes_signing_key <WIDEWINE_AES_KEY> \\\n  --aes_signing_iv <WIDEWINE_IV> \\\n  --mpd_output video.mpd\n\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Fields")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Required"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"org_code"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"The organization code for API endpoint"),(0,a.kt)("td",{parentName:"tr",align:null},"Yes")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"content_id"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"The unique identifier for the content (Should be a random UUID generated you. This UUID will be used for getting licenses for that video.)"),(0,a.kt)("td",{parentName:"tr",align:null},"Yes")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"WIDEVINE_AES_KEY"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"The AES key used for Widevine encryption"),(0,a.kt)("td",{parentName:"tr",align:null},"Yes")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"WIDEVINE_IV"),(0,a.kt)("td",{parentName:"tr",align:null},"string"),(0,a.kt)("td",{parentName:"tr",align:null},"The initialization vector (IV) for Widevine encryption"),(0,a.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,a.kt)("admonition",{type:"important"},(0,a.kt)("p",{parentName:"admonition"},"WIDEWINE_AES_KEY , WIDEWINE_IV  and org_code will be provided by us.")),(0,a.kt)("h2",{id:"fairplay-encryption"},"Fairplay Encryption"),(0,a.kt)("p",null,"This API allows users to obtain a FairPlay encryption key. It provides the necessary functionality to acquire the encryption key for ensuring secure content delivery on Apple's platforms."),(0,a.kt)("p",null,"This API requires ",(0,a.kt)("a",{parentName:"p",href:"/docs/server-api/authentication"},"authentication Header")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"POST: https://app.tpstreams.com/api/v1/{{org_code}}/fairplay_key/\n")),(0,a.kt)("p",null,"with request body:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n  "request": "eyJjb250ZW50X2lkIjoiY2Y2YzMwZGQ1MGMxNDkyZTgyMzQ0ZWEzZTEzOWRhMWQifQ==",\n  "signature": "NsBcxxchrA7tFw/O86SCM5hwiM6Np/+JnZgjlV0vRyo="\n}\n')),(0,a.kt)("h3",{id:"generating-request-body"},"Generating Request Body:"),(0,a.kt)("p",null,"You can obtain the request field by performing the following steps in Python:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"import json\nimport base64\n\ndata = {\"content_id\": \"cf6c30dd50c1492e82344ea3e139da1d\"}\ndata = json.dumps(data, separators=(',', ':'))\nresult = base64.urlsafe_b64encode(data.encode())\n# The result will be eyJjb250ZW50X2lkIjoiY2Y2YzMwZGQ1MGMxNDkyZTgyMzQ0ZWEzZTEzOWRhMWQifQ==\n")),(0,a.kt)("h3",{id:"generating-signature"},"Generating Signature:"),(0,a.kt)("p",null,"You can obtain the signature field by performing the following steps in Python:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'import base64\nimport binascii\nimport hashlib\nimport json\n\n\nfrom Cryptodome.Cipher import AES\nfrom Cryptodome.Util.Padding import pad\n\ndef generate_signature(data, key, iv):\n    hash = hashlib.sha1(base64.b64encode(data.encode())).digest()\n    cipher = AES.new(\n        binascii.unhexlify(key),\n        AES.MODE_CBC,\n        binascii.unhexlify(iv),\n    )\n    padded_hash = pad(hash, AES.block_size, style="pkcs7")\n    signature = cipher.encrypt(padded_hash)\n    return base64.b64encode(signature).decode()\n\nkey = "xxxx"  # AES Signing key\niv = "yyy"  # AES Signing iv\ndata = {\n  "content_id": "cf6c30dd50c1492e82344ea3e139da1d"\n}\ndata = json.dumps(data, separators=(\',\', \':\'))\nsignature = generate_signature(data, key, iv)\nresult = base64.urlsafe_b64encode(data.encode())\n\npost_data = {\n  "request": result,\n  "signature": signature\n}\n')),(0,a.kt)("p",null,"Response"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "iv": "f70bce4094fd4612abac60d9809c5b0c",\n  "key": "3ab60de900d64edf9cb25a76f81794e6",\n  "uri": "skd://e5573f8bb8ac47ea839a65beae73263d",\n}\n')))}d.isMDXComponent=!0}}]);