"use strict";(self.webpackChunkstreams_docs=self.webpackChunkstreams_docs||[]).push([[6943],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>y});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),y=r,m=u["".concat(s,".").concat(y)]||u[y]||d[y]||i;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},128:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:5},o="Shaka Player Integration Guide",l={unversionedId:"video-embedding/shaka-player-integration",id:"video-embedding/shaka-player-integration",title:"Shaka Player Integration Guide",description:"This guide will walk you through integrating Shaka Player for playing TPStreams Non-DRM & multi-DRM-protected videos on your site.",source:"@site/docs/video-embedding/shaka-player-integration.md",sourceDirName:"video-embedding",slug:"/video-embedding/shaka-player-integration",permalink:"/docs/video-embedding/shaka-player-integration",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"videoEmbeddingSidebar",previous:{title:"Player Parameters",permalink:"/docs/video-embedding/javascript-sdk/player-params"}},s={},p=[{value:"Why Use Shaka Player?",id:"why-use-shaka-player",level:3},{value:"Setting Up Non-DRM Video Playback",id:"setting-up-non-drm-video-playback",level:3},{value:"1.2 Initialize the Shaka Player",id:"12-initialize-the-shaka-player",level:4},{value:"Setting Up Multi-DRM Video Playback",id:"setting-up-multi-drm-video-playback",level:3},{value:"2.1 Load Manifest URL",id:"21-load-manifest-url",level:4},{value:"2.2 Generate DRM License URLs",id:"22-generate-drm-license-urls",level:4},{value:"2.3 Implement Widevine DRM Support",id:"23-implement-widevine-drm-support",level:4},{value:"2.4 Implement FairPlay DRM Support",id:"24-implement-fairplay-drm-support",level:4},{value:"Setting Up Offline Download Support",id:"setting-up-offline-download-support",level:3}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"shaka-player-integration-guide"},"Shaka Player Integration Guide"),(0,r.kt)("p",null,"This guide will walk you through integrating Shaka Player for playing TPStreams Non-DRM & multi-DRM-protected videos on your site."),(0,r.kt)("h3",{id:"why-use-shaka-player"},"Why Use Shaka Player?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Adaptive Streaming: Automatically adjusts video quality based on network conditions."),(0,r.kt)("li",{parentName:"ul"},"Multi-DRM Support: Supports major DRM systems like Widevine, and FairPlay."),(0,r.kt)("li",{parentName:"ul"},"Cross-Browser Compatibility: Works across all modern browsers."),(0,r.kt)("li",{parentName:"ul"},"Open Source: Free to use and backed by Google.")),(0,r.kt)("h3",{id:"setting-up-non-drm-video-playback"},"Setting Up Non-DRM Video Playback"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.1 Set Up the Basic HTML Structure"),(0,r.kt)("br",{parentName:"p"}),"\n","Create an HTML file, include the Shaka Player library and add a video element to play the video."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n    <head>\n    \x3c!-- Shaka Player compiled library: --\x3e\n    <script src="dist/shaka-player.compiled.js"><\/script>\n    \x3c!-- Your application source: --\x3e\n    <script src="myapp.js"><\/script>\n    </head>\n    <body>\n    <video id="video"\n            width="640"\n            poster="//shaka-player-demo.appspot.com/assets/poster.jpg"\n            controls autoplay></video>\n    </body>\n</html>\n')),(0,r.kt)("h4",{id:"12-initialize-the-shaka-player"},"1.2 Initialize the Shaka Player"),(0,r.kt)("p",null,"Initialize a new instance of the Shaka Player and then attach it to the video element in your HTML and provide the manifest URL of your non-DRM video to the Shaka Player. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// You can obtain the M3U8 URL either through our portal or using our Asset Detail API. \nconst manifestUri ='<TPStreams M3U8 URL>';\n\nfunction initApp() {\n    // Install built-in polyfills to patch browser incompatibilities.\n    shaka.polyfill.installAll();\n\n    if (shaka.Player.isBrowserSupported()) {\n    initPlayer();\n    } else {\n    console.error('Browser not supported!');\n    }\n}\n\nasync function initPlayer() {\n    const video = document.getElementById('video');\n    const player = new shaka.Player();\n    await player.attach(video);\n\n    // Attach player to the window to make it easy to access in the JS console.\n    window.player = player;\n\n    try {\n    await player.load(manifestUri);\n    console.log('The video has now been loaded!');\n    } catch (e) {\n    onError(e);\n    }\n}\n\nfunction onErrorEvent(event) {\n    onError(event.detail);\n}\n\nfunction onError(error) {\n    console.error('Error code', error.code, 'object', error);\n}\n\ndocument.addEventListener('DOMContentLoaded', initApp);\n")),(0,r.kt)("h3",{id:"setting-up-multi-drm-video-playback"},"Setting Up Multi-DRM Video Playback"),(0,r.kt)("p",null,"Now, let's extend our setup to support DRM-protected content. We will cover both Widevine and FairPlay DRM systems."),(0,r.kt)("h4",{id:"21-load-manifest-url"},"2.1 Load Manifest URL"),(0,r.kt)("p",null,"Determine browser type using the user agent string to select either HLS (m3u8) for Safari or DASH (mpd) for others, ensuring compatibility with various DRM systems. You can obtain the both M3U8 and MPD file URLs via our Asset Detail API."),(0,r.kt)("h4",{id:"22-generate-drm-license-urls"},"2.2 Generate DRM License URLs"),(0,r.kt)("p",null,"To obtain DRM license URLs for both Widevine and FairPlay, follow these steps:"),(0,r.kt)("p",null,"Generate an access token granting access to the TPStreams License API. Refer to the provided ",(0,r.kt)("a",{parentName:"p",href:"./authentication"},"documentation")," for instructions."),(0,r.kt)("p",null,"Use the following endpoint to construct the license URLs for both Widevine and FairPlay:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"https://app.tpstreams.com/api/v1/<ORG_ID>/assets/<ASSET_ID>/drm_license/?access_token=<ACCESS_TOKEN>&drm_type=<DRM_TYPE>\n")),(0,r.kt)("p",null,"Replace placeholders with actual values:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"<ORG_ID>: Your organization's ID"),(0,r.kt)("li",{parentName:"ul"},"<ASSET_ID>: ID of the asset"),(0,r.kt)("li",{parentName:"ul"},"<ACCESS_TOKEN>: Access token obtained in above step."),(0,r.kt)("li",{parentName:"ul"},'<DRM_TYPE>: Use "widevine" for Widevine or "fairplay" for FairPlay.')),(0,r.kt)("p",null,"Incorporate the generated license URLs into your Shaka Player configuration for Widevine and FairPlay DRM support. "),(0,r.kt)("h4",{id:"23-implement-widevine-drm-support"},"2.3 Implement Widevine DRM Support"),(0,r.kt)("p",null,"Specify the license server URL in the DRM configuration to enable Widevine DRM: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"player.configure({\n    drm: {\n    servers: {\n        'com.widevine.alpha': WIDEVINE_LICENSE_URL,\n    },\n    },\n});\n")),(0,r.kt)("p",null,"Register request filters with Shaka Player's networking engine to modify license requests: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"player.getNetworkingEngine().registerRequestFilter(function (type, request) {\n    if (type == shaka.net.NetworkingEngine.RequestType.LICENSE) {\n    // This ensures that the license request contains the appropriate content type, \n    // which is required by our API \n    request.headers['Content-type'] = 'application/octet-stream';\n    }\n});\n")),(0,r.kt)("h4",{id:"24-implement-fairplay-drm-support"},"2.4 Implement FairPlay DRM Support"),(0,r.kt)("p",null,"Retrieve the FairPlay DRM certificate from a specified URL before playback. This certificate is essential for decrypting the video content."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const response = await fetch(CERTIFICATE_PATH);\nconst certificate = await response.arrayBuffer();\n")),(0,r.kt)("p",null,"Configure Shaka Player to use FairPlay DRM by specifying the license server URL and the fetched certificate in the DRM configuration. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"player.configure({\n    drm: {\n    servers: {\n        'com.apple.fps.1_0': FAIRPLAY_LICENSE_URL,\n    },\n    advanced: {\n        'com.apple.fps.1_0': {\n        serverCertificate: new Uint8Array(certificate),\n        },\n    },\n    },\n});\n")),(0,r.kt)("p",null,"Modify the initialization data for FairPlay by extracting the content ID and adjusting the license URL. This ensures proper handling of the video content by the FairPlay DRM system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"player.configure('drm.initDataTransform', (initData, type, drmInfo) => {\n    if (type != 'skd') return initData;\n    const contentId = new TextDecoder(\"utf-16\").decode(initData.slice(16));\n    const cert = player.drmInfo().serverCertificate;\n\n    return shaka.util.FairPlayUtils.initDataTransform(\n        initData,\n        contentId,\n        cert\n    );\n});\n")),(0,r.kt)("p",null,"Register request filters with Shaka Player's networking engine to modify license requests. For FairPlay, set the appropriate headers and payload for the license request."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"player.getNetworkingEngine().registerRequestFilter(function (type, request) {\n    if (type == shaka.net.NetworkingEngine.RequestType.LICENSE) {\n    request.uris = [FAIRPLAY_LICENSE_URL];\n    request.method = 'POST';\n    request.headers['Content-Type'] = 'application/json';\n    const originalPayload = new Uint8Array(request.body);\n    const base64Payload = shaka.util.Uint8ArrayUtils.toStandardBase64(originalPayload);\n    request.body = JSON.stringify({\n        spc: base64Payload,\n    });\n    }\n});\n")),(0,r.kt)("h3",{id:"setting-up-offline-download-support"},"Setting Up Offline Download Support"),(0,r.kt)("p",null,"Shaka Player supports offline playback, enabling users to download and play DRM-protected videos without an active internet connection. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Refer to the Shaka Player ",(0,r.kt)("a",{parentName:"li",href:"https://shaka-player-demo.appspot.com/docs/api/tutorial-offline.html"},"documentation")," for implementing offline support. "),(0,r.kt)("li",{parentName:"ul"},"When configuring DRM settings for offline download, follow the steps outlined earlier to construct the DRM license URL. Additionally, ensure to include the query parameter download=true to acquire a persistent license suitable for offline use. ")),(0,r.kt)("p",null,"For complete sample code, refer to our sample ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/testpress/shaka-player-demo/"},"repository"),"."))}d.isMDXComponent=!0}}]);